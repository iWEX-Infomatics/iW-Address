[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2025-09-20 17:24:54.740751",
  "module": "Validation",
  "name": "Item concatenation",
  "script": "frappe.ui.form.on('Item', {\r\n    onload(frm) {\r\n        if (frm.is_new()) {\r\n            frm.set_value(\"item_name\", \"\");\r\n        }\r\n    },\r\n    custom_item_name_combination(frm) {\r\n        if (frm.doc.custom_item_name_combination == 1) {\r\n            open_item_combination_dialog(frm);\r\n        }\r\n    },\r\n    custom_spice: update_fields,\r\n    custom_qty: update_fields,\r\n    custom_uom: update_fields,\r\n    custom_group_abbr: update_fields,\r\n    custom_packing_type: update_fields,\r\n    custom_packing_type_abbr: update_fields\r\n});\r\n\r\nfunction open_item_combination_dialog(frm) {\r\n    let dialog = new frappe.ui.Dialog({\r\n        title: 'Item Name Combination Setup',\r\n        size: 'large',\r\n        fields: [\r\n            {\r\n                fieldname: 'spices',\r\n                fieldtype: 'Link',\r\n                label: 'Select Spices',\r\n                options: 'Spices',\r\n                reqd: 1,\r\n                change: function() {\r\n                    let selected_spice = dialog.get_value('spices');\r\n                    if (selected_spice) {\r\n                        frm.set_value('custom_spice', selected_spice);\r\n                        update_fields(frm);\r\n                    }\r\n                }\r\n            },\r\n            { fieldtype: \"Column Break\" },\r\n            {\r\n                fieldname: 'qty',\r\n                fieldtype: 'Link',\r\n                label: 'Select Quantity',\r\n                options: 'Qty',\r\n                reqd: 1,\r\n                change: function() {\r\n                    let selected_qty = dialog.get_value('qty');\r\n                    if (selected_qty) {\r\n                        frm.set_value('custom_qty', selected_qty);\r\n                        update_fields(frm);\r\n                    }\r\n                }\r\n            },{ fieldtype: \"Section Break\" },\r\n            {\r\n                fieldname: 'uom',\r\n                fieldtype: 'Link',\r\n                label: 'Select UOM',\r\n                options: 'UOM',\r\n                reqd: 1,\r\n                change: function() {\r\n                    let selected_uom = dialog.get_value('uom');\r\n                    if (selected_uom) {\r\n                        frm.set_value('custom_uom', selected_uom);\r\n                        update_fields(frm);\r\n                    }\r\n                }\r\n            },\r\n            { fieldtype: \"Column Break\" },\r\n            {\r\n                fieldname: 'packing_type',\r\n                fieldtype: 'Link',\r\n                label: 'Select Packing Type',\r\n                options: 'Packing Type',\r\n                reqd: 1,\r\n                change: function() {\r\n                    let selected_packing = dialog.get_value('packing_type');\r\n                    if (selected_packing) {\r\n                        frm.set_value('custom_packing_type', selected_packing);\r\n                        update_fields(frm);\r\n                    }\r\n                }\r\n            }\r\n        ],\r\n        primary_action_label: 'Apply Selection',\r\n        primary_action(values) {\r\n            // Set all selected values to form\r\n            if (values.spices) frm.set_value('custom_spice', values.spices);\r\n            if (values.qty) frm.set_value('custom_qty', values.qty);\r\n            if (values.uom) frm.set_value('custom_uom', values.uom);\r\n            if (values.packing_type) frm.set_value('custom_packing_type', values.packing_type);\r\n            \r\n            // Trigger update function\r\n            update_fields(frm);\r\n            \r\n            dialog.hide();\r\n            // frappe.msgprint('Item name combination updated successfully!');\r\n        },\r\n        secondary_action_label: 'Cancel',\r\n        secondary_action() {\r\n            dialog.hide();\r\n        }\r\n    });\r\n    \r\n    // Pre-populate existing values if any\r\n    if (frm.doc.custom_spice) dialog.set_value('spices', frm.doc.custom_spice);\r\n    if (frm.doc.custom_qty) dialog.set_value('qty', frm.doc.custom_qty);\r\n    if (frm.doc.custom_uom) dialog.set_value('uom', frm.doc.custom_uom);\r\n    if (frm.doc.custom_packing_type) dialog.set_value('packing_type', frm.doc.custom_packing_type);\r\n    \r\n    dialog.show();\r\n}\r\n\r\nfunction update_fields(frm) {\r\n    if (frm.doc.custom_item_name_combination != 1) {\r\n        return;\r\n    }\r\n    const groupAbbr = (frm.doc.custom_group_abbr || \"\").trim();\r\n    const itemGroup = (frm.doc.item_group || \"\").trim().toLowerCase();\r\n    let spice = (frm.doc.custom_spice || \"\").trim();\r\n    const qty = (frm.doc.custom_qty || \"\").toString().trim();\r\n    const uom = (frm.doc.custom_uom || \"\").trim();\r\n    const packingType = (frm.doc.custom_packing_type || \"\").trim();\r\n    let packingAbbr = (frm.doc.custom_packing_type_abbr || \"\").trim();\r\n    \r\n    // Capitalize packing abbreviation\r\n    packingAbbr = capitalizeFirstLetter(packingAbbr);\r\n    \r\n    // Remove duplicate item group word from end of spice\r\n    if (spice && spice.toLowerCase().endsWith(itemGroup)) {\r\n        spice = spice.slice(0, -itemGroup.length).trim();\r\n    }\r\n    \r\n    // If nothing is provided, reset fields\r\n    if (!(groupAbbr || spice || qty || uom || packingAbbr)) {\r\n        frm.set_value(\"item_name\", \"\");\r\n        frm.set_value(\"description\", \"\");\r\n        return;\r\n    }\r\n    \r\n    // --- Build Item Name ---\r\n    const itemNameParts = [];\r\n    if (groupAbbr) itemNameParts.push(groupAbbr);\r\n    if (spice) itemNameParts.push(spice);\r\n    if (qty || uom) itemNameParts.push(`${qty}${uom}`.trim());\r\n    if (packingAbbr) itemNameParts.push(packingAbbr);\r\n    const itemName = itemNameParts.filter(Boolean).join(\" - \");\r\n    \r\n    // --- Build Description ---\r\n    const descParts = [];\r\n    if (spice) descParts.push(spice);\r\n    if (qty || uom) descParts.push(`${qty}${uom}`.trim());\r\n    if (packingType) descParts.push(packingType);\r\n    const description = descParts.filter(Boolean).join(\" \").replace(/\\s+/g, \" \").trim();\r\n    \r\n    frm.set_value(\"item_name\", itemName);\r\n    frm.set_value(\"description\", description);\r\n}\r\n\r\nfunction capitalizeFirstLetter(str) {\r\n    if (!str) return \"\";\r\n    return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n\r\n",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 1,
  "modified": "2025-09-23 17:41:49.941457",
  "module": "Validation",
  "name": "Autofill Item Code",
  "script": "frappe.ui.form.on('Item', {\r\n    onload: function(frm) {\r\n        console.log(\"Form loaded - Debug Info:\", {\r\n            is_new: frm.is_new(),\r\n            custom_group_abbr: frm.doc.custom_group_abbr,\r\n            item_group: frm.doc.item_group\r\n        });\r\n        \r\n        if (frm.is_new() && frm.doc.custom_group_abbr && frm.doc.item_group) {\r\n            check_item_group_and_generate(frm);\r\n        } else {\r\n            manage_item_code_visibility(frm);\r\n        }\r\n    },\r\n    \r\n    item_group: function(frm) {\r\n        console.log(\"Item group changed to:\", frm.doc.item_group);\r\n        \r\n        setTimeout(() => {\r\n            if (frm.doc.custom_group_abbr && frm.doc.item_group) {\r\n                check_item_group_and_generate(frm);\r\n            } else {\r\n                manage_item_code_visibility(frm);\r\n            }\r\n        }, 100);\r\n    },\r\n    \r\n    item_name: function(frm) {\r\n        if (frm.doc.custom_group_abbr) {\r\n            check_item_group_and_generate(frm);\r\n        }\r\n    },\r\n    \r\n    custom_group_abbr: function(frm) {\r\n        console.log(\"Custom group abbr changed to:\", frm.doc.custom_group_abbr);\r\n        \r\n        setTimeout(() => {\r\n            if (frm.doc.custom_group_abbr && frm.doc.item_group) {\r\n                check_item_group_and_generate(frm);\r\n            } else if (!frm.doc.custom_group_abbr) {\r\n                frm.set_value('item_code', '');\r\n                console.log(\"Custom group abbr cleared, cleared item code\");\r\n                manage_item_code_visibility(frm);\r\n            }\r\n        }, 100);\r\n    },\r\n    \r\n    before_save: function(frm) {\r\n        if (frm.fields_dict.item_code.df.hidden && frm.doc.item_name) {\r\n            frm.set_value('item_code', frm.doc.item_name);\r\n            console.log(\"Set item_code equal to item_name before save:\", frm.doc.item_name);\r\n        }\r\n    },\r\n    \r\n    after_save: function(frm) {\r\n        manage_item_code_visibility(frm);\r\n    }\r\n});\r\n\r\nfunction manage_item_code_visibility(frm) {\r\n    if (!frm.doc.item_group) {\r\n        frm.toggle_display('item_code', true);\r\n        return;\r\n    }\r\n    \r\n    should_automate_item_code(frm, function(should_automate) {\r\n        if (should_automate) {\r\n            frm.toggle_display('item_code', true);\r\n            console.log(\"Item code field shown for automated group\");\r\n        } else {\r\n            frm.toggle_display('item_code', false);\r\n            console.log(\"Item code field hidden for non-automated group\");\r\n            if (frm.is_new()) {\r\n                frm.set_value('item_code', '');\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\n\r\nfunction should_automate_item_code(frm, callback) {\r\n    if (!frm.doc.item_group) {\r\n        callback(false);\r\n        return;\r\n    }\r\n    \r\n    if (frm.doc.item_group === \"Packing Materials\") {\r\n        callback(false);\r\n        return;\r\n    }\r\n    \r\n    if (frm.doc.item_group === \"Selling Items\" || frm.doc.item_group === \"Buying Items\") {\r\n        callback(true);\r\n        return;\r\n    }\r\n    \r\n    frappe.call({\r\n        method: \"frappe.client.get\",\r\n        args: {\r\n            doctype: \"Item Group\",\r\n            name: frm.doc.item_group,\r\n            fields: [\"parent_item_group\"]\r\n        },\r\n        callback: function(r) {\r\n            if (r.message && r.message.parent_item_group) {\r\n                if (r.message.parent_item_group === \"Selling Items\" || \r\n                    r.message.parent_item_group === \"Buying Items\") {\r\n                    callback(true);\r\n                } else {\r\n                    callback(false);\r\n                }\r\n            } else {\r\n                callback(false);\r\n            }\r\n        },\r\n        error: function(err) {\r\n            console.error(\"Error fetching item group details:\", err);\r\n            callback(false);\r\n        }\r\n    });\r\n}\r\n\r\nfunction check_item_group_and_generate(frm) {\r\n    if (!frm.doc.item_group) {\r\n        console.log(\"No item group selected\");\r\n        return;\r\n    }\r\n    \r\n    should_automate_item_code(frm, function(should_automate) {\r\n        if (should_automate) {\r\n            frm.toggle_display('item_code', true);\r\n            generate_item_code(frm);\r\n        } else {\r\n            console.log(\"Item group excluded from auto-generation\");\r\n            frm.toggle_display('item_code', false);\r\n            if (frm.doc.item_code && frm.is_new()) {\r\n                frm.set_value('item_code', '');\r\n                console.log(\"Cleared item code for excluded group\");\r\n            }\r\n        }\r\n    });\r\n}\r\n\r\nfunction generate_item_code(frm) {\r\n    let abbr = frm.doc.custom_group_abbr;\r\n    \r\n    if (!abbr || !frm.doc.item_group) {\r\n        console.log(\"Conditions not met:\", {\r\n            abbr: abbr,\r\n            item_group: frm.doc.item_group\r\n        });\r\n        return;\r\n    }\r\n    \r\n    console.log(\"Generating item code for:\", {\r\n        abbr: abbr,\r\n        item_group: frm.doc.item_group\r\n    });\r\n    \r\n    frappe.call({\r\n        method: \"frappe.client.get_list\",\r\n        args: {\r\n            doctype: \"Item\",\r\n            filters: [\r\n                [\"item_code\", \"like\", abbr + \" - %\"]\r\n            ],\r\n            fields: [\"item_code\"],\r\n            order_by: \"item_code desc\",\r\n            limit_page_length: 1\r\n        },\r\n        callback: function(r) {\r\n            console.log(\"API Response:\", r);\r\n            \r\n            let new_sequence = \"001\";\r\n            \r\n            if (r.message && r.message.length > 0) {\r\n                let last_item_code = r.message[0].item_code;\r\n                console.log(\"Last item code:\", last_item_code);\r\n                \r\n                let parts = last_item_code.split(' - ');\r\n                if (parts.length >= 2) {\r\n                    let last_sequence = parts[parts.length - 1]; \r\n                    let next_sequence = parseInt(last_sequence) + 1;\r\n                    \r\n                    if (isNaN(next_sequence)) {\r\n                        next_sequence = 1;\r\n                    }\r\n                    \r\n                    new_sequence = String(next_sequence).padStart(3, '0');\r\n                }\r\n            }\r\n            \r\n            let new_item_code = `${abbr} - ${new_sequence}`;\r\n            console.log(\"Generated item code:\", new_item_code);\r\n            \r\n            frm.set_value('item_code', new_item_code).then(() => {\r\n                if (frm.doc.item_name) {\r\n                    frm.set_value('item_name', \"\");\r\n                }\r\n                frm.refresh_field('item_code');\r\n            }).catch(err => {\r\n                console.error(\"Error setting item code:\", err);\r\n            });\r\n        },\r\n        error: function(err) {\r\n            console.error(\"API Error:\", err);\r\n        }\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Role Permission for Page and Report",
  "enabled": 1,
  "modified": "2025-07-30 18:14:19.831294",
  "module": "Validation",
  "name": "Role Perm",
  "script": "frappe.ui.form.on('Role Permission for Page and Report', {\n  page:function(frm) {\n    if(frm.doc.roles.length < 1){\n            frm.clear_custom_buttons();\n        frm.page.clear_actions();\n    }\n  },\n  update_report_page_data: function (frm) {\n        if (frm.doc.page == \"backups\"){\n            frm.clear_custom_buttons();\n        frm.page.clear_actions();\n        frm.set_query('page', function() {\n            return {\n                filters: [\n                    ['name', '!=', 'backups']\n                    ['name', '!=', 'permission-manager']\n                ]\n            };\n        });\n    }}\n});",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Customer",
  "enabled": 0,
  "modified": "2025-08-26 10:07:53.520487",
  "module": "Validation",
  "name": "Customer Group",
  "script": "frappe.ui.form.on('Customer', {\r\n    // Trigger on form load\r\n    onload: function(frm) {\r\n        set_customer_group_if_individual(frm);\r\n        set_tax_category_based_on_territory(frm);\r\n        set_default_accounts_and_credit_limits(frm);\r\n    },\r\n    \r\n    // Trigger when customer_type field changes\r\n    customer_type: function(frm) {\r\n        set_customer_group_if_individual(frm);\r\n        set_tax_category_based_on_territory(frm);\r\n        set_default_accounts_and_credit_limits(frm);\r\n    },\r\n    \r\n    // Trigger when territory field changes\r\n    territory: function(frm) {\r\n        set_tax_category_based_on_territory(frm);\r\n    },\r\n    \r\n    // Mobile number validation\r\n    custom_mobile: function(frm) {\r\n        validate_mobile_number(frm);\r\n    },\r\n    \r\n    // Validate before save\r\n    validate: function(frm) {\r\n        validate_mobile_number(frm);\r\n    }\r\n});\r\n\r\nfunction set_customer_group_if_individual(frm) {\r\n    if (frm.doc.customer_type === 'Individual') {\r\n        frm.set_value('customer_group', 'Individual');\r\n    }\r\n}\r\n\r\nfunction set_tax_category_based_on_territory(frm) {\r\n    if (frm.doc.customer_type === 'Individual' && frm.doc.territory) {\r\n        // Check if territory is under Kerala\r\n        frappe.call({\r\n            method: 'frappe.client.get',\r\n            args: {\r\n                doctype: 'Territory',\r\n                name: frm.doc.territory\r\n            },\r\n            callback: function(r) {\r\n                if (r.message) {\r\n                    check_territory_hierarchy(frm, r.message);\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction check_territory_hierarchy(frm, territory_doc) {\r\n    // If current territory is Kerala, set In-State\r\n    if (territory_doc.name === 'Kerala') {\r\n        frm.set_value('tax_category', 'In-State');\r\n        return;\r\n    }\r\n    \r\n    // If territory has a parent, check the parent recursively\r\n    if (territory_doc.parent_territory && territory_doc.parent_territory !== 'All Territories') {\r\n        frappe.call({\r\n            method: 'frappe.client.get',\r\n            args: {\r\n                doctype: 'Territory',\r\n                name: territory_doc.parent_territory\r\n            },\r\n            callback: function(r) {\r\n                if (r.message) {\r\n                    if (r.message.name === 'Kerala') {\r\n                        frm.set_value('tax_category', 'In-State');\r\n                    } else if (r.message.parent_territory && r.message.parent_territory !== 'All Territories') {\r\n                        // Continue checking up the hierarchy\r\n                        check_territory_hierarchy(frm, r.message);\r\n                    } else {\r\n                        // Reached top level without finding Kerala\r\n                        frm.set_value('tax_category', 'Out-State');\r\n                    }\r\n                } else {\r\n                    frm.set_value('tax_category', 'Out-State');\r\n                }\r\n            }\r\n        });\r\n    } else {\r\n        // No parent or reached top level, set Out-State\r\n        frm.set_value('tax_category', 'Out-State');\r\n    }\r\n}\r\n\r\nfunction set_default_accounts_and_credit_limits(frm) {\r\n    if (frm.doc.customer_type === 'Individual') {\r\n        // Auto-fill accounts child table\r\n        set_default_accounts(frm);\r\n        \r\n        // Auto-fill credit_limits child table\r\n        set_default_credit_limits(frm);\r\n    }\r\n}\r\n\r\nfunction set_default_accounts(frm) {\r\n    // Check if accounts table is empty or doesn't have the required entry\r\n    let company = \"Auraspace Traders Pvt Ltd\";\r\n    let account = \"Debtors INR - AT\";\r\n    \r\n    let existing_row = frm.doc.accounts.find(row => \r\n        row.company === company && row.account === account\r\n    );\r\n    \r\n    if (!existing_row) {\r\n        // Check if there's an empty row or create new one\r\n        let empty_row = frm.doc.accounts.find(row => !row.company && !row.account);\r\n        \r\n        if (empty_row) {\r\n            // Fill the empty row\r\n            frappe.model.set_value(empty_row.doctype, empty_row.name, 'company', company);\r\n            frappe.model.set_value(empty_row.doctype, empty_row.name, 'account', account);\r\n        } else {\r\n            // Add new row\r\n            let new_row = frm.add_child('accounts');\r\n            new_row.company = company;\r\n            new_row.account = account;\r\n        }\r\n        \r\n        frm.refresh_field('accounts');\r\n    }\r\n}\r\n\r\nfunction set_default_credit_limits(frm) {\r\n    // Check if credit_limits table is empty or doesn't have the required entry\r\n    let company = \"Auraspace Traders Pvt Ltd\";\r\n    \r\n    let existing_row = frm.doc.credit_limits.find(row => row.company === company);\r\n    \r\n    if (!existing_row) {\r\n        // Check if there's an empty row or create new one\r\n        let empty_row = frm.doc.credit_limits.find(row => !row.company);\r\n        \r\n        if (empty_row) {\r\n            // Fill the empty row\r\n            frappe.model.set_value(empty_row.doctype, empty_row.name, 'company', company);\r\n        } else {\r\n            // Add new row\r\n            let new_row = frm.add_child('credit_limits');\r\n            new_row.company = company;\r\n        }\r\n        \r\n        frm.refresh_field('credit_limits');\r\n    }\r\n}\r\n\r\n// Mobile number validation function\r\nfunction validate_mobile_number(frm) {\r\n    if (frm.doc.customer_type === 'Individual' && frm.doc.custom_mobile) {\r\n        let mobile = String(frm.doc.custom_mobile);\r\n        \r\n        // Remove any spaces, hyphens, or other non-digit characters\r\n        mobile = mobile.replace(/\\D/g, '');\r\n        \r\n        // Check if it's exactly 10 digits\r\n        if (mobile.length !== 10) {\r\n            frappe.msgprint({\r\n                title: __('Invalid Mobile Number'),\r\n                indicator: 'red',\r\n                message: __('Mobile number must be exactly 10 digits for Individual customers.')\r\n            });\r\n            frm.set_focus('custom_mobile');\r\n            // Clear invalid value or keep it for user to correct\r\n            // frm.set_value('custom_mobile', '');\r\n            return false;\r\n        }\r\n        \r\n        // Check if it starts with valid Indian mobile prefixes (optional)\r\n        let validPrefixes = ['6', '7', '8', '9'];\r\n        if (!validPrefixes.includes(mobile[0])) {\r\n            frappe.msgprint({\r\n                title: __('Invalid Mobile Number'),\r\n                indicator: 'orange',\r\n                message: __('Mobile number should start with 6, 7, 8, or 9 for Indian numbers.')\r\n            });\r\n            frm.set_focus('custom_mobile');\r\n            return false;\r\n        }\r\n        \r\n        // If validation passes, update the field with clean number\r\n        if (String(frm.doc.custom_mobile) !== mobile) {\r\n            frm.set_value('custom_mobile', parseInt(mobile));\r\n        }\r\n        \r\n        return true;\r\n    }\r\n    return true;\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Invoice",
  "enabled": 1,
  "modified": "2025-12-06 12:37:51.593939",
  "module": "Validation",
  "name": "Sales Invoice",
  "script": "frappe.form.link_formatters['Item'] = function(value, doc) {\r\n    if (doc.item_name && doc.item_name !== value) {\r\n        return value + ': ' + doc.item_name;\r\n    } else {\r\n        return value;\r\n    }\r\n};\r\n\r\nfrappe.ui.form.on(\"Sales Invoice\", {\r\n    refresh: function(frm) {\r\n        let zero_qty_items = frm.doc.items.filter(i => i.actual_qty == 0);\r\n\r\n        if (zero_qty_items.length > 0) {\r\n            frm.add_custom_button(__('Create Product Bundle'), function() {\r\n                open_product_bundle_dialog(frm, zero_qty_items);\r\n            });\r\n        }\r\n\r\n        (frm.doc.packed_items || []).forEach(row => {\r\n            row.custom_amount = flt(row.qty) * flt(row.rate);\r\n        });\r\n        frm.refresh_field(\"packed_items\");\r\n        update_total_custom_amount(frm);\r\n    },\r\n\r\n    packed_items_remove: function(frm) {\r\n        update_total_custom_amount(frm);\r\n    }\r\n});\r\nfrappe.ui.form.on(\"Packed Item\", {\r\n    qty: function(frm, cdt, cdn) {\r\n        calculate_custom_amount(frm, cdt, cdn);\r\n    },\r\n    rate: function(frm, cdt, cdn) {\r\n        calculate_custom_amount(frm, cdt, cdn);\r\n    }\r\n});\r\n\r\n\r\nfunction calculate_custom_amount(frm, cdt, cdn) {\r\n    let row = locals[cdt][cdn];\r\n    row.custom_amount = flt(row.qty) * flt(row.rate);\r\n\r\n    frm.refresh_field(\"packed_items\");\r\n    update_total_custom_amount(frm);\r\n}\r\nfunction update_total_custom_amount(frm) {\r\n    let total = 0;\r\n    (frm.doc.packed_items || []).forEach(row => {\r\n        total += flt(row.custom_amount);\r\n    });\r\n    \r\n    frm.set_value(\"custom_total_amount\", total).then(() => {\r\n        frm.save();\r\n    });\r\n}\r\nfunction open_product_bundle_dialog(frm, zero_qty_items) {\r\n    let parent_item_options = zero_qty_items.map(i => i.item_code);\r\n\r\n    let dialog = new frappe.ui.Dialog({\r\n        title: \"Create Product Bundle\",\r\n        size: \"large\",\r\n        fields: [\r\n            {\r\n                label: \"Parent Item\",\r\n                fieldname: \"parent_item\",\r\n                fieldtype: \"Select\",\r\n                options: parent_item_options,\r\n                reqd: 1,\r\n                change: function() {\r\n                    let selected_item = zero_qty_items.find(i => i.item_code === dialog.get_value(\"parent_item\"));\r\n                    if (selected_item) {\r\n                        dialog.set_value(\"parent_description\", selected_item.description);\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                label: \"Description\",\r\n                fieldname: \"parent_description\",\r\n                fieldtype: \"Small Text\",\r\n                read_only: 0\r\n            },\r\n            {\r\n                fieldtype: \"Section Break\"\r\n            },\r\n            {\r\n                fieldname: \"bundle_items\",\r\n                fieldtype: \"Table\",\r\n                label: \"Bundle Items\",\r\n                cannot_add_rows: false,\r\n                in_place_edit: false,\r\n                fields: [\r\n                    {\r\n                        fieldname: \"item_code\",\r\n                        label: \"Item Code\", \r\n                        fieldtype: \"Link\",\r\n                        options: \"Item\",\r\n                        in_list_view: 1,\r\n                        reqd: 1,\r\n                        columns: 4,\r\n                        get_query: function() {\r\n                            // Sirf \"Buying Items\" aur uske child groups ke items\r\n                            let valid_item_groups = [\"Buying Items\"];\r\n                            \r\n                            frappe.call({\r\n                                method: \"frappe.client.get_list\",\r\n                                args: {\r\n                                    doctype: \"Item Group\",\r\n                                    fields: [\"name\"],\r\n                                    filters: [\r\n                                        [\"parent_item_group\", \"=\", \"Buying Items\"]\r\n                                    ]\r\n                                },\r\n                                async: false,\r\n                                callback: function(r) {\r\n                                    if (r.message && r.message.length > 0) {\r\n                                        valid_item_groups = valid_item_groups.concat(r.message.map(d => d.name));\r\n                                    }\r\n                                }\r\n                            });\r\n                            \r\n                            return {\r\n                                filters: {\r\n                                    item_group: [\"in\", valid_item_groups],\r\n                                    disabled: 0\r\n                                }\r\n                            };\r\n                        }\r\n                    },\r\n                    {\r\n                        fieldname: \"qty\",\r\n                        label: \"Qty\",\r\n                        fieldtype: \"Float\", \r\n                        in_list_view: 1,\r\n                        reqd: 1,\r\n                        columns: 1.5,\r\n                        precision: 2\r\n                    },\r\n                    {\r\n                        fieldname: \"uom\",\r\n                        label: \"UOM\",\r\n                        fieldtype: \"Link\",\r\n                        options: \"UOM\",\r\n                        in_list_view: 1,\r\n                        columns: 1.5\r\n                    },\r\n                    {\r\n                        fieldname: \"description\",\r\n                        label: \"Description\",\r\n                        fieldtype: \"Small Text\",\r\n                        in_list_view: 0,\r\n                        columns: 5\r\n                    }\r\n                ]\r\n            }\r\n        ],\r\n        primary_action_label: \"Create Product Bundle\",\r\n        primary_action(values) {\r\n            if (!values.parent_item) {\r\n                frappe.msgprint(\"Parent Item is required\");\r\n                return;\r\n            }\r\n\r\n            // Direct Product Bundle create karo\r\n            frappe.call({\r\n                method: \"frappe.client.insert\",\r\n                args: {\r\n                    doc: {\r\n                        doctype: \"Product Bundle\",\r\n                        new_item_code: values.parent_item,\r\n                        description: values.parent_description,\r\n                        items: values.bundle_items || []\r\n                    }\r\n                },\r\n                callback: function(r) {\r\n                    if (!r.exc) {\r\n                        frappe.msgprint(\"Product Bundle Created: \" + r.message.name);\r\n                        dialog.hide();\r\n                        \r\n                        // Item row ko find karo\r\n                        let item_row = frm.doc.items.find(i => i.item_code === values.parent_item);\r\n                        \r\n                        if (item_row) {\r\n                            // Item code ko temporarily clear karo aur phir set karo\r\n                            // Isse item_code change event trigger hoga\r\n                            let temp_item = item_row.item_code;\r\n                            item_row.item_code = '';\r\n                            frm.refresh_field('items');\r\n                            \r\n                            setTimeout(() => {\r\n                                item_row.item_code = temp_item;\r\n                                frm.refresh_field('items');\r\n                                \r\n                                frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\r\n                                \r\n                                setTimeout(() => {\r\n                                    frm.save();\r\n                                }, 1000);\r\n\r\n                            }, 300);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    dialog.set_secondary_action(function() {\r\n        window.open(`/app/item/new-item-1`, \"_blank\");\r\n    });\r\n    dialog.set_secondary_action_label(\"Create New Item\");\r\n\r\n    if (parent_item_options.length > 0) {\r\n        dialog.set_value(\"parent_item\", parent_item_options[0]);\r\n        dialog.set_value(\"parent_description\", zero_qty_items[0].description);\r\n    }\r\n\r\n    dialog.show();\r\n\r\n    setTimeout(() => {\r\n        setupItemEvents(dialog);\r\n    }, 500);\r\n}\r\n\r\nfunction refresh_sales_order_item(frm, parent_item) {\r\n    // Sales Order items table mein parent_item ko find karo\r\n    let item_row = frm.doc.items.find(i => i.item_code === parent_item);\r\n    \r\n    if (item_row) {\r\n        // Item details ko refresh karo taaki packed_items populate ho\r\n        frappe.call({\r\n            method: \"frappe.client.get\",\r\n            args: {\r\n                doctype: \"Item\",\r\n                name: parent_item\r\n            },\r\n            callback: function(r) {\r\n                if (r.message) {\r\n                    // Product Bundle ke items ko fetch karo\r\n                    frappe.call({\r\n                        method: \"frappe.client.get_list\",\r\n                        args: {\r\n                            doctype: \"Product Bundle\",\r\n                            filters: {\r\n                                new_item_code: parent_item\r\n                            },\r\n                            fields: [\"name\"]\r\n                        },\r\n                        callback: function(bundle_response) {\r\n                            if (bundle_response.message && bundle_response.message.length > 0) {\r\n                                let bundle_name = bundle_response.message[0].name;\r\n                                \r\n                                // Product Bundle items ko fetch karo\r\n                                frappe.call({\r\n                                    method: \"frappe.client.get\",\r\n                                    args: {\r\n                                        doctype: \"Product Bundle\",\r\n                                        name: bundle_name\r\n                                    },\r\n                                    callback: function(bundle_doc) {\r\n                                        if (bundle_doc.message && bundle_doc.message.items) {\r\n                                            // Packed items table ko clear karo\r\n                                            item_row.packed_items = [];\r\n                                            \r\n                                            // Product Bundle ke items ko packed_items mein add karo\r\n                                            bundle_doc.message.items.forEach(function(bundle_item) {\r\n                                                let packed_item = frappe.model.add_child(item_row, \"packed_items\");\r\n                                                packed_item.parent_item = parent_item;\r\n                                                packed_item.item_code = bundle_item.item_code;\r\n                                                packed_item.qty = bundle_item.qty * (item_row.qty || 1);\r\n                                                packed_item.description = bundle_item.description;\r\n                                                \r\n                                                // Rate fetch karo\r\n                                                frappe.call({\r\n                                                    method: \"frappe.client.get_value\",\r\n                                                    args: {\r\n                                                        doctype: \"Item\",\r\n                                                        fieldname: [\"standard_rate\", \"last_purchase_rate\"],\r\n                                                        filters: {name: bundle_item.item_code}\r\n                                                    },\r\n                                                    async: false,\r\n                                                    callback: function(rate_response) {\r\n                                                        if (rate_response.message) {\r\n                                                            packed_item.rate = rate_response.message.last_purchase_rate || \r\n                                                                              rate_response.message.standard_rate || 0;\r\n                                                        }\r\n                                                    }\r\n                                                });\r\n                                            });\r\n                                            \r\n                                            // Form ko refresh karo\r\n                                            frm.refresh_field(\"items\");\r\n                                            frm.dirty();\r\n                                            frappe.msgprint(__(\"Packed items loaded successfully for {0}\", [parent_item]));\r\n                                        }\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction setupItemEvents(dialog) {\r\n    let wrapper = dialog.$wrapper;\r\n    let table = wrapper.find('[data-fieldname=\"bundle_items\"]');\r\n    \r\n    table.off('change.item_uom');\r\n    table.on('change.item_uom', '[data-fieldname=\"item_code\"] input', function(e) {\r\n        let $input = $(this);\r\n        let item_code = $input.val();\r\n        \r\n        if (item_code) {\r\n            let $row = $input.closest('.grid-row');\r\n            let row_index = $row.attr('data-idx') - 1;\r\n            let grid_data = dialog.fields_dict.bundle_items.grid.data;\r\n            let row_doc = grid_data[row_index];\r\n            \r\n            if (row_doc) {\r\n                // Fetch item details\r\n                frappe.call({\r\n                    method: \"frappe.client.get_value\",\r\n                    args: {\r\n                        doctype: \"Item\",\r\n                        fieldname: [\"stock_uom\", \"item_name\", \"description\"],\r\n                        filters: {name: item_code}\r\n                    },\r\n                    callback: function(r) {\r\n                        if (r.message) {\r\n                            row_doc.uom = r.message.stock_uom || \"\";\r\n                            row_doc.description = r.message.description || \"\";\r\n                            \r\n                            let $uom_input = $row.find('[data-fieldname=\"uom\"] input');\r\n                            let $desc_input = $row.find('[data-fieldname=\"description\"] textarea');\r\n                            \r\n                            $uom_input.val(r.message.stock_uom || \"\");\r\n                            $desc_input.val(r.message.description || \"\");\r\n                            \r\n                            $uom_input.trigger('change');\r\n                            $desc_input.trigger('change');\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    table.on('blur.item_uom', '[data-fieldname=\"item_code\"] .link-field input', function(e) {\r\n        $(this).trigger('change.item_uom');\r\n    });\r\n}",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2025-12-09 11:35:53.825206",
  "module": "Validation",
  "name": "Sales Order Bundle",
  "script": "frappe.form.link_formatters['Item'] = function(value, doc) {\r\n    if (doc.item_name && doc.item_name !== value) {\r\n        return value + ': ' + doc.item_name;\r\n    } else {\r\n        return value;\r\n    }\r\n};\r\n\r\nfrappe.ui.form.on(\"Sales Order\", {\r\n    refresh: function(frm) {\r\n        let zero_qty_items = frm.doc.items.filter(i => i.actual_qty == 0);\r\n\r\n        if (zero_qty_items.length > 0) {\r\n            frm.add_custom_button(__('Create Product Bundle'), function() {\r\n                open_product_bundle_dialog(frm, zero_qty_items);\r\n            });\r\n        }\r\n\r\n        // Calculate custom_amount for all packed_items\r\n        (frm.doc.packed_items || []).forEach(row => {\r\n            row.custom_amount = flt(row.qty) * flt(row.rate);\r\n        });\r\n        frm.refresh_field(\"packed_items\");\r\n        \r\n        // Calculate bundle items total from packed_items\r\n        calculate_bundle_totals_from_packed_items(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on(\"Packed Item\", {\r\n    qty: function(frm, cdt, cdn) {\r\n        calculate_custom_amount(frm, cdt, cdn);\r\n        calculate_bundle_totals_from_packed_items(frm);\r\n    },\r\n    rate: function(frm, cdt, cdn) {\r\n        calculate_custom_amount(frm, cdt, cdn);\r\n        calculate_bundle_totals_from_packed_items(frm);\r\n    },\r\n    parent_item: function(frm, cdt, cdn) {\r\n        calculate_bundle_totals_from_packed_items(frm);\r\n    }\r\n});\r\n\r\nfrappe.ui.form.on(\"Sales Order Item\", {\r\n    rate: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        validate_bundle_rate(frm, row);\r\n    },\r\n    custom_bundle_items_total: function(frm, cdt, cdn) {\r\n        let row = locals[cdt][cdn];\r\n        validate_bundle_rate(frm, row);\r\n    }\r\n});\r\n\r\n\r\nfunction calculate_custom_amount(frm, cdt, cdn) {\r\n    let row = locals[cdt][cdn];\r\n    row.custom_amount = flt(row.qty) * flt(row.rate);\r\n    frm.refresh_field(\"packed_items\");\r\n}\r\n\r\nfunction calculate_bundle_totals_from_packed_items(frm) {\r\n    // Reset all custom_bundle_items_total to 0\r\n    (frm.doc.items || []).forEach(function(item_row) {\r\n        item_row.custom_bundle_items_total = 0;\r\n    });\r\n    \r\n    // Calculate totals from packed_items\r\n    (frm.doc.packed_items || []).forEach(function(packed_item) {\r\n        if (packed_item.parent_item) {\r\n            // Find matching item in items table\r\n            let item_row = frm.doc.items.find(i => i.item_code === packed_item.parent_item);\r\n            \r\n            if (item_row) {\r\n                let custom_amount = flt(packed_item.custom_amount) || (flt(packed_item.qty) * flt(packed_item.rate));\r\n                item_row.custom_bundle_items_total = flt(item_row.custom_bundle_items_total) + custom_amount;\r\n            }\r\n        }\r\n    });\r\n    \r\n    frm.refresh_field(\"items\");\r\n}\r\n\r\nfunction validate_bundle_rate(frm, item_row) {\r\n    let bundle_total = flt(item_row.custom_bundle_items_total) || 0;\r\n    let item_rate = flt(item_row.rate) || 0;\r\n    let item_qty = flt(item_row.qty) || 1;\r\n    let item_amount = item_rate * item_qty;\r\n    \r\n    if (bundle_total > 0 && item_amount < bundle_total) {\r\n        frappe.msgprint({\r\n            title: __('Rate Warning'),\r\n            indicator: 'orange',\r\n            message: __('The rate is less than the bundle items total for item {0}. <br><br>Item Amount: {1}<br>Bundle Items Total: {2}', \r\n                [item_row.item_code, item_amount.toFixed(2), bundle_total.toFixed(2)])\r\n        });\r\n    }\r\n}\r\n\r\n\r\nfunction open_product_bundle_dialog(frm, zero_qty_items) {\r\n    let parent_item_options = zero_qty_items.map(i => i.item_code);\r\n\r\n    let dialog = new frappe.ui.Dialog({\r\n        title: \"Create Product Bundle\",\r\n        size: \"large\",\r\n        fields: [\r\n            {\r\n                label: \"Parent Item\",\r\n                fieldname: \"parent_item\",\r\n                fieldtype: \"Select\",\r\n                options: parent_item_options,\r\n                reqd: 1,\r\n                change: function() {\r\n                    let selected_item = zero_qty_items.find(i => i.item_code === dialog.get_value(\"parent_item\"));\r\n                    if (selected_item) {\r\n                        dialog.set_value(\"parent_description\", selected_item.description);\r\n                    }\r\n                }\r\n            },\r\n            {\r\n                label: \"Description\",\r\n                fieldname: \"parent_description\",\r\n                fieldtype: \"Small Text\",\r\n                read_only: 0\r\n            },\r\n            {\r\n                fieldtype: \"Section Break\"\r\n            },\r\n            {\r\n                fieldname: \"bundle_items\",\r\n                fieldtype: \"Table\",\r\n                label: \"Bundle Items\",\r\n                cannot_add_rows: false,\r\n                in_place_edit: false,\r\n                fields: [\r\n                    {\r\n                        fieldname: \"item_code\",\r\n                        label: \"Item Code\", \r\n                        fieldtype: \"Link\",\r\n                        options: \"Item\",\r\n                        in_list_view: 1,\r\n                        reqd: 1,\r\n                        columns: 3,\r\n                        get_query: function() {\r\n                            let valid_item_groups = [\"Buying Items\"];\r\n                            \r\n                            frappe.call({\r\n                                method: \"frappe.client.get_list\",\r\n                                args: {\r\n                                    doctype: \"Item Group\",\r\n                                    fields: [\"name\"],\r\n                                    filters: [\r\n                                        [\"parent_item_group\", \"=\", \"Buying Items\"]\r\n                                    ]\r\n                                },\r\n                                async: false,\r\n                                callback: function(r) {\r\n                                    if (r.message && r.message.length > 0) {\r\n                                        valid_item_groups = valid_item_groups.concat(r.message.map(d => d.name));\r\n                                    }\r\n                                }\r\n                            });\r\n                            \r\n                            return {\r\n                                filters: {\r\n                                    item_group: [\"in\", valid_item_groups],\r\n                                    disabled: 0\r\n                                }\r\n                            };\r\n                        }\r\n                    },\r\n                    {\r\n                        fieldname: \"qty\",\r\n                        label: \"Qty\",\r\n                        fieldtype: \"Float\", \r\n                        in_list_view: 1,\r\n                        reqd: 1,\r\n                        columns: 2,\r\n                        precision: 2\r\n                    },\r\n                    {\r\n                        fieldname: \"uom\",\r\n                        label: \"UOM\",\r\n                        fieldtype: \"Link\",\r\n                        options: \"UOM\",\r\n                        in_list_view: 1,\r\n                        columns: 2\r\n                    },\r\n                    {\r\n                        fieldname: \"description\",\r\n                        label: \"Description\",\r\n                        fieldtype: \"Small Text\",\r\n                        in_list_view: 0,\r\n                        columns: 4\r\n                    }\r\n                ]\r\n            }\r\n        ],\r\n        primary_action_label: \"Create Product Bundle\",\r\n        primary_action(values) {\r\n            if (!values.parent_item) {\r\n                frappe.msgprint(\"Parent Item is required\");\r\n                return;\r\n            }\r\n\r\n            // Product Bundle items without rate\r\n            let bundle_items = (values.bundle_items || []).map(item => {\r\n                return {\r\n                    item_code: item.item_code,\r\n                    qty: item.qty,\r\n                    uom: item.uom,\r\n                    description: item.description\r\n                };\r\n            });\r\n\r\n            // Create Product Bundle\r\n            frappe.call({\r\n                method: \"frappe.client.insert\",\r\n                args: {\r\n                    doc: {\r\n                        doctype: \"Product Bundle\",\r\n                        new_item_code: values.parent_item,\r\n                        description: values.parent_description,\r\n                        items: bundle_items\r\n                    }\r\n                },\r\n                callback: function(r) {\r\n                    if (!r.exc) {\r\n                        frappe.msgprint(\"Product Bundle Created: \" + r.message.name);\r\n                        dialog.hide();\r\n                        \r\n                        // Item row ko find karo\r\n                        let item_row = frm.doc.items.find(i => i.item_code === values.parent_item);\r\n                        \r\n                        if (item_row) {\r\n                            // Item code ko temporarily clear karo aur phir set karo\r\n                            let temp_item = item_row.item_code;\r\n                            item_row.item_code = '';\r\n                            frm.refresh_field('items');\r\n                            \r\n                            setTimeout(() => {\r\n                                item_row.item_code = temp_item;\r\n                                frm.refresh_field('items');\r\n                                \r\n                                frm.script_manager.trigger('item_code', item_row.doctype, item_row.name);\r\n                                \r\n                                setTimeout(() => {\r\n                                    frm.save();\r\n                                }, 1000);\r\n\r\n                            }, 300);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    });\r\n\r\n    dialog.set_secondary_action(function() {\r\n        window.open(`/app/item/new-item-1`, \"_blank\");\r\n    });\r\n    dialog.set_secondary_action_label(\"Create New Item\");\r\n\r\n    if (parent_item_options.length > 0) {\r\n        dialog.set_value(\"parent_item\", parent_item_options[0]);\r\n        dialog.set_value(\"parent_description\", zero_qty_items[0].description);\r\n    }\r\n\r\n    dialog.show();\r\n\r\n    setTimeout(() => {\r\n        setupItemEvents(dialog);\r\n    }, 500);\r\n}\r\n\r\nfunction refresh_sales_order_item(frm, parent_item) {\r\n    let item_row = frm.doc.items.find(i => i.item_code === parent_item);\r\n    \r\n    if (item_row) {\r\n        frappe.call({\r\n            method: \"frappe.client.get\",\r\n            args: {\r\n                doctype: \"Item\",\r\n                name: parent_item\r\n            },\r\n            callback: function(r) {\r\n                if (r.message) {\r\n                    frappe.call({\r\n                        method: \"frappe.client.get_list\",\r\n                        args: {\r\n                            doctype: \"Product Bundle\",\r\n                            filters: {\r\n                                new_item_code: parent_item\r\n                            },\r\n                            fields: [\"name\"]\r\n                        },\r\n                        callback: function(bundle_response) {\r\n                            if (bundle_response.message && bundle_response.message.length > 0) {\r\n                                let bundle_name = bundle_response.message[0].name;\r\n                                \r\n                                frappe.call({\r\n                                    method: \"frappe.client.get\",\r\n                                    args: {\r\n                                        doctype: \"Product Bundle\",\r\n                                        name: bundle_name\r\n                                    },\r\n                                    callback: function(bundle_doc) {\r\n                                        if (bundle_doc.message && bundle_doc.message.items) {\r\n                                            item_row.packed_items = [];\r\n                                            \r\n                                            bundle_doc.message.items.forEach(function(bundle_item) {\r\n                                                let packed_item = frappe.model.add_child(item_row, \"packed_items\");\r\n                                                packed_item.parent_item = parent_item;\r\n                                                packed_item.item_code = bundle_item.item_code;\r\n                                                packed_item.qty = bundle_item.qty * (item_row.qty || 1);\r\n                                                packed_item.description = bundle_item.description;\r\n                                                packed_item.rate = bundle_item.rate || 0;\r\n                                            });\r\n                                            \r\n                                            frm.refresh_field(\"items\");\r\n                                            frm.dirty();\r\n                                            frappe.msgprint(__(\"Packed items loaded successfully for {0}\", [parent_item]));\r\n                                        }\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\nfunction setupItemEvents(dialog) {\r\n    let wrapper = dialog.$wrapper;\r\n    let table = wrapper.find('[data-fieldname=\"bundle_items\"]');\r\n    \r\n    table.off('change.item_uom');\r\n    table.on('change.item_uom', '[data-fieldname=\"item_code\"] input', function(e) {\r\n        let $input = $(this);\r\n        let item_code = $input.val();\r\n        \r\n        if (item_code) {\r\n            let $row = $input.closest('.grid-row');\r\n            let row_index = $row.attr('data-idx') - 1;\r\n            let grid_data = dialog.fields_dict.bundle_items.grid.data;\r\n            let row_doc = grid_data[row_index];\r\n            \r\n            if (row_doc) {\r\n                // Fetch item details (without rate)\r\n                frappe.call({\r\n                    method: \"frappe.client.get_value\",\r\n                    args: {\r\n                        doctype: \"Item\",\r\n                        fieldname: [\"stock_uom\", \"item_name\", \"description\"],\r\n                        filters: {name: item_code}\r\n                    },\r\n                    callback: function(r) {\r\n                        if (r.message) {\r\n                            row_doc.uom = r.message.stock_uom || \"\";\r\n                            row_doc.description = r.message.description || \"\";\r\n                            \r\n                            let $uom_input = $row.find('[data-fieldname=\"uom\"] input');\r\n                            let $desc_input = $row.find('[data-fieldname=\"description\"] textarea');\r\n                            \r\n                            $uom_input.val(r.message.stock_uom || \"\");\r\n                            $desc_input.val(r.message.description || \"\");\r\n                            \r\n                            $uom_input.trigger('change');\r\n                            $desc_input.trigger('change');\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n    table.on('blur.item_uom', '[data-fieldname=\"item_code\"] .link-field input', function(e) {\r\n        $(this).trigger('change.item_uom');\r\n    });\r\n}",
  "view": "Form"
 }
]